# 战斗时的单位操作界面

## 当前状态

在战斗中单位的状态会发生变化，需要实时存储。

包括当前血量、魔力，

单位在地图上的位置，

单位受到的buff / debuff，以及其持续时间（剩余回合数，每次该单位行动则-1），这些效果会对能力值造成影响。

## 单位操作

单位需要移动、攻击、技能以及结束四种操作类型，考虑放在屏幕右下角由玩家选择进行哪种操作，另外选择任意一种操作时都需要提供一个返回键返回到为选择操作类型的状态。每种操作最多只能进行一次，不可撤销，且攻击和技能只允许进行其中一个。

![Untitled](Untitled%204.png)

<aside>
💡 这个是用ppt简单画的，别在意太简陋。战斗界面的大致ui如上，这里是进入我方操作时的样子

</aside>

### 移动

读取单位当前的移动力，在地图上通过寻路算法计算能移动到的范围并高亮显示。  

![Untitled](Untitled%201%202.png)

<aside>
💡 点击移动后显示可移动范围，老虎挡住了所以那个位置去不了。

</aside>

### 攻击

搜索范围内 是否存在地方单位，选择进行攻击。

![Untitled](Untitled%202%202.png)

<aside>
💡 点击攻击后显示普通攻击范围，选择要使用的技能（包括普通攻击）后再显示技能范围，对敌对友用颜色区别。选择要使用的技能后再选择施放目标，如果目标单位不可用（比如打自己人，或给地方回血）则弹个警告。

</aside>

### 技能

在单位中应当存储该单位具有的技能，应当在选择使用时从单独的技能类代码中进行调用。此外，技能需要分为指向性和非指向性两类，前者同理与攻击需要考虑范围（技能范围，在技能内单独设置）内是否存在可选目标（此处需要判断敌友情况，如治疗技能）。

### 结束

即直接结束对于该单位的操作。

（可选）此外，在行动条机制下，对于移动和攻击/技能两类操作，如果其中一种未进行，则减少10%读条，如条为100，未移动则只需要读90的条，都没进行的跳过行为则只需要读80的条。

# 伤害计算公式

采用最为直观的减法

```cpp
damage = 攻击方(m_)atk * k(技能伤害倍率) - 防御方(m_)def;
```

因而在数值上需要严谨设计以保证平衡性

**注意**，damage得到的值为负数或0时直接视为1，即最低伤害为1.

# 伤害浮动性

在伤害计算的基础上提供一点浮动性以使得战斗中存在一定的随机性，将上方公式计算得到伤害按上下10%的随机范围进行浮动。

# 行动顺序机制

考虑两种，选择其中一种

## 1. 行动条

根据角色的速度值决定行动顺序，角色每读完一次条即可进行一次操作。

![Untitled](Untitled%203%201.png)

> 手游《第七史诗》中的行动条
> 

该游戏实际上是回合制rpg手游，不过做了行动条的可视化（画面左侧）。如图，这些角色相当于在左边这个竖条顺箭头方向往下跑，哪个角色跑到最下放就到哪个角色的回合（所以该游戏有使用超高速度角色连续进行回合的玩法）。当然这个不是真的按时间往下跑，一个角色行动结束后直接算出下一个跑到终点的角色进行回合。

<aside>
💡 写到着才想起来米哈游的星铁可能玩过的会多一点，该游戏就是典型的行动条机制，不过第七史诗有行动条的可视化，优先想到了。

</aside>

### 特殊情况顺序判断

部分情况下会出现读条完成时间一致的情况，此时优先速度快者行动，如果速度还是一致，则根据角色唯一的ID顺序判断。

## 2. 回合制

这种情况下是双方轮流操作，如a阵营和b阵营，a操作完他的所有角色后才到b，通过检测是否所有角色结束操作来判断回合结束，也可以单独添加一个回合结束按钮从而不用每个角色都点操作结束。

在战棋类游戏中其实更常用，因为方便玩家摆阵型。